#
#MAKEFILE FOR Q!D!64!
#Copyright 2019 Zig/Defame
#
SHELL := /bin/bash

help: ## This help
	@echo -e "$$(grep -hE '^\S+:.*##' $(MAKEFILE_LIST) | sed -e 's/:.*##\s*/:/' -e 's/^\(.\+\):\(.*\)/\\x1b[36m\1\\x1b[m:\2/' | column -c2 -t -s :)"

all: clean disk.d64 ## clean up and make the disk image

autogenerate: ## autogenerate conversion templates
	bin/convert_c.py
	bin/convert_sid.py

rsrc: autogenerate ## populate the rsrc directory from autogenerated templates
	cd src;kick convert_animations.asm
	cd src;kick convert_music.asm

src/demo.prg:  src/demo.asm ## compile c64 demo
	kick $<

disk.d64: tinn-fe/src/demo.prg ## create complete c64 disk demo
	c1541 -format "defame,2a" d64 $@
	cd tinn-fe/src;wine ~/Applications/exomizer-3.1.0/win32/exomizer.exe sfx basic -n demo.prg 
	c1541 -attach $@ -write tinn-fe/src/a.out "start" 
	c1541 -attach $@ -write tinn-fe/src/greets.prg "01"
	c1541 -attach $@ -write tinn-fe/src/noter.prg "02"
	c1541 -attach $@ -write tinn-fe/src/draw.prg "03"

clean: ## Clean up
	rm src/*.sym src/*.prg *.d64 src/.source.txt src/convert_animations.asm src/convert_music.asm
	


