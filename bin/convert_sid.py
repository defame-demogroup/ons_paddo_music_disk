#!/usr/bin/env python3
import os
from pathlib import Path


current: Path = Path(os.path.dirname(os.path.realpath(__file__)))
root: Path = current.parent.absolute()
music_source = root.joinpath("assets/music")
music_target = root.joinpath("src")
music_target.mkdir(parents=True, exist_ok=True)
print(f"Rendering SID conversion template...{music_source}")
output: Path = music_target.joinpath("convert_music.asm")
with open(output, mode="w") as o:
    o.write("""
/*
This file is autogenerated by bin/convert_sid.py
*/
    """)
    count: int  = 0
    for filename in os.listdir(music_source):
        if filename.endswith(".sid"):
            name: str = filename.strip(".sid")
            ptr: str = str(count).rjust(2,'0')
            o.write(f"""
            .var music_{ptr} = LoadSid("../assets/music/{filename}")
            .segment SID_{ptr} [outPrg="../rsrc/{ptr}.prg"]
            *=music_{ptr}.location "Music_{ptr}"
            .fill music_{ptr}.size, music_{ptr}.getData(i)
            """)
            count += 1
        else:
            continue
