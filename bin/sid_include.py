#!/usr/bin/env python3
import os
from pathlib import Path


"""
This code generates a baseline file that we then adapt.
If you overwrite the src/sid_include.asm with the 
output of this render, it will be different! This is used
to simply bootstrap the demo coding because I don't want
to manually type all this stuff. 
"""


current: Path = Path(os.path.dirname(os.path.realpath(__file__)))
root: Path = current.parent.absolute()
music_source = root.joinpath("assets/music")
music_target = root.joinpath("rsrc")
music_target.mkdir(parents=True, exist_ok=True)
print(f"Rendering SID labels...{music_source}")
output: Path = music_target.joinpath("sid_include.asm")
with open(output, mode="w") as o:
    o.write("""
/*
This file is autogenerated by bin/sid_include.py
*/
.var sid_name = List()
.var sid_disk = List()
    """)
    count: int  = 0
    for filename in os.listdir(music_source):
        if filename.endswith(".sid"):
            ptr: str = str(count).rjust(2,'0')
            # clean up (Patto) [8580] [1x]-optimized
            # note: double-double-space-replace is on purpose! 
            name: str = ptr + " " + filename.replace(".sid","").replace("(Patto)","").replace("[8580]","").replace("[1x]","").replace("[2x]","").replace("-optimized","").replace("  "," ").replace("  "," ").strip()
            o.write(f"""
//{ptr}.prg = {filename}
.eval sid_name.add("{name}")
.eval sid_disk.add(0)
            """)
            count += 1
